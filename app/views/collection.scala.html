@(id: String, content: com.fasterxml.jackson.databind.JsonNode, home: controllers.HomeController)

@import play.api.libs.json._

@main("Details: " + id) {
	@defining(Json.parse(content.toString())) { parsedContent =>
	    <h1>@Html((parsedContent \ "title").asOpt[String].getOrElse(id))</h1>
	    <h2>Collection</h2>
	    <table class='table table-striped table-condensed'>
	        @produceRow(home.label("extent"), parsedContent \ "extent", (s:String) => None)
	        @produceRow(home.label("creator") + " " + home.label("name"), parsedContent \ "creator" \ "name", (s:String) => None)
	        @produceRow(home.label("creator") + " " + home.label("url"), parsedContent \ "creator" \ "url", (s:String) => Some(s))
	        @produceRow(home.label("language"), (parsedContent \ "language"), (s:String) => None)
	        @produceRow(home.label("isPartOf"), parsedContent \ "isPartOf", (s:String) => Some(s))
	        @produceRow(home.label("type"), parsedContent \ "type", (s:String) => Some(s))
	        @produceRow(home.label("otherTitleInformation"), parsedContent \ "otherTitleInformation", (s:String) => None)
	        @produceRow(home.label("isPrimaryTopicOf"), parsedContent \ "isPrimaryTopicOf", (s:String) => Some(s))
	        @produceRow(home.label("spatial"), parsedContent \ "spatial", (s:String) => None)
	        @produceRow(home.label("homepage"), parsedContent \ "homepage", (s:String) => Some(s))
	        @produceRow(home.label("subject"), (parsedContent \ "subject"), (s:String) => Some(s))
	    </table>
	}
}

@produceRow(name: String, value: JsReadable, link: String => Option[String]) = {
	@if(value.asOpt[Seq[JsValue]].isDefined){
		@produceMultipleRows(name, value.asOpt[Seq[JsValue]].getOrElse(Seq()))
	} else {
		@produceSingleRow(name, value.asInstanceOf[JsLookupResult], link)
	}
}

@produceSingleRow(name: String, value: JsLookupResult, link: String => Option[String]) = {
    @if(value.asOpt[JsValue].isDefined){
        @defining(value.as[String].substring(0,value.as[String].length())) { valueAsString =>
            <tr>
                <td class="field-label">
                    @name
                </td>
                <td class="field-value">
                    @if(!link(valueAsString).isDefined) {
                        @home.label(valueAsString)
                    } else {
                        <a href="@valueAsString">@link(home.label(valueAsString)).get</a>
                    }
                </td>
            </tr>
        }
    }
}

@produceMultipleRows(displayName: String, array: Seq[JsValue]) = {
	<tr>
		<td class="field-label">@displayName</td>
          @for((value, i) <- array.zipWithIndex) {
            @if(i == 0) {
              <td class="field-value">
                @home.label(value.as[String])
              </td>
            } else {
              <tr>
                <td class="field-value"></td>
                <td class="field-value">
                  @home.label(value.as[String])
                 </td>
              </tr>
            }
          }
    </tr>
}
