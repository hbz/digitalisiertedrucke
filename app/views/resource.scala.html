@(id: String, contentPrint: com.fasterxml.jackson.databind.JsonNode, contentDigital: com.fasterxml.jackson.databind.JsonNode, home: controllers.HomeController)

@import play.api.libs.json._

@localLink(link: String) = @{ link.replace("digitalisiertedrucke.de", request.host) }

@main("Details: " + id) {

@defining(Json.parse(contentPrint.toString())) { parsedContentPrint =>
    <h1>@Html((parsedContentPrint \ "title").asOpt[String].getOrElse(id))</h1>
    <h2>Print</h2>
    <table class='table table-striped table-condensed'>
        @produceRow(home.label("medium"), parsedContentPrint \ "medium", (s:String) => Some(s))
        @produceRow(home.label("bibliographicCitation"), parsedContentPrint \ "bibliographicCitation",_ => None)
        @produceRow(home.label("fulltextOnline"), parsedContentPrint \ "fulltextOnline", (s:String) => Some(s))
       
        <tr>
          <td>@home.label("type")</td>
          @for((resourceType, i) <- (parsedContentPrint \ "type").asOpt[Seq[JsValue]].getOrElse(Seq()).zipWithIndex) {
            @if(i == 0) {          
              <td>
                @home.label(resourceType.as[String])
              </td>
            } else {
              <tr>
                <td></td>
                <td>
                  @home.label(resourceType.as[String])
                 </td>
              </tr>
            }
          }
        </tr>
        
    </table>
}

@defining(Json.parse(contentDigital.toString())) { parsedContentDigital =>
    <h2>Digital</h2>
    <table class='table table-striped table-condensed'>
        @produceRow(home.label("created"), parsedContentDigital \ "created", _ => None)
        @produceRow(home.label("publisher"), parsedContentDigital \ "publisher",_ => None)
        @produceRow(home.label("medium"), parsedContentDigital \ "medium", (s:String) => Some(s))
        @produceRow(home.label("fulltextOnline"), parsedContentDigital \ "fulltextOnline", (s:String) => Some(s))
        @produceRow(home.label("type"), parsedContentDigital \ "type", (s:String) => Some(s))
        
        <tr>
          <td>@home.label("isPartOf")</td>
          @for((isPartOf, i) <- (parsedContentDigital \ "isPartOf").asOpt[Seq[JsValue]].getOrElse(Seq()).zipWithIndex) {
            @if(i == 0) {          
              <td>
                <a href='@localLink(isPartOf.as[String])'>@home.label(isPartOf.as[String])</a>
              </td>
            } else {
              <tr>
                <td></td>
                <td>
                  <a href='@localLink(isPartOf.as[String])'>@home.label(isPartOf.as[String])</a>
                 </td>
              </tr>
            }
          }
        </tr>
    </table>
}

}

@produceRow(name: String, value: JsLookupResult, link: String => Option[String]) = {
    @if(value.asOpt[JsValue].isDefined){
        @defining(value.as[String].substring(0,value.as[String].length())) { valueAsString =>
            @if(home.label(valueAsString) != "") {
                <tr>
                    <td class="field-label">
                        @name
                    </td>
                    <td class="field-value">
                        @if(!link(valueAsString).isDefined) {
                            @home.label(valueAsString)
                        } else {
                            <a href="@valueAsString">@link(home.label(valueAsString)).get</a>
                        }
                    </td>
                </tr>
            }
        }
    }
}
