@(id: String, contentPrint: com.fasterxml.jackson.databind.JsonNode, contentDigital: com.fasterxml.jackson.databind.JsonNode, home: controllers.HomeController)

@import play.api.libs.json._

@main("Details: " + id) {

@defining(Json.parse(contentPrint.toString())) { parsedContentPrint =>
    <h1>@((parsedContentPrint \ "title").asOpt[String].getOrElse(id))</h1>
    <h2>Print</h2>
    <table class='table table-striped table-condensed'>
        @produceRow("hasFormat", parsedContentPrint \ "hasFormat", (s:String) => Some(s))
        @produceRow("Medium", parsedContentPrint \ "medium", (s:String) => Some(s))
        @produceRow("Bibliographische Angabe", parsedContentPrint \ "bibliographicCitation",_ => None)
        @produceRow("Volltext", parsedContentPrint \ "fulltextOnline", (s:String) => Some(s))        
       
        <tr>
          <td>Art</td>
          @for((resourceType, i) <- (parsedContentPrint \ "type").asOpt[Seq[JsValue]].getOrElse(Seq()).zipWithIndex) {
            @if(i == 0) {          
              <td>
                @resourceType.as[String]
              </td>
            } else {
              <tr>
                <td></td>
                <td>
                  @resourceType.as[String]
                 </td>
              </tr>
            }
          }
        </tr>
        
    </table>
}

@defining(Json.parse(contentDigital.toString())) { parsedContentDigital =>
    <h2>Digital</h2>
    <table class='table table-striped table-condensed'>
        @produceRow("isFormatOf", parsedContentDigital \ "isFormatOf", (s:String) => Some(s))
        @produceRow("erstellt", parsedContentDigital \ "created", _ => None)
        @produceRow("publisher", parsedContentDigital \ "publisher",_ => None)
        @produceRow("medium", parsedContentDigital \ "medium", (s:String) => Some(s))
        @produceRow("Volltext", parsedContentDigital \ "fulltextOnline", (s:String) => Some(s))
        @produceRow("Art", parsedContentDigital \ "type", (s:String) => Some(s))
        
        <tr>
          <td>isPartOf</td>
          @for((isPartOf, i) <- (parsedContentDigital \ "isPartOf").asOpt[Seq[JsValue]].getOrElse(Seq()).zipWithIndex) {
            @if(i == 0) {          
              <td>
                @home.label(isPartOf.as[String])
              </td>
            } else {
              <tr>
                <td></td>
                <td>
                  @home.label(isPartOf.as[String])
                 </td>
              </tr>
            }
          }
        </tr>
    </table>
}

}

@produceRow(name: String, value: JsLookupResult, link: String => Option[String]) = {
    @if(value.asOpt[JsValue].isDefined){
        @defining(value.as[String].substring(0,value.as[String].length())) { valueAsString =>
            <tr>
                <td class="field-label">
                    @name
                </td>
                <td class="field-value">
                    @if(!link(valueAsString).isDefined) {
                        @home.label(valueAsString)
                    } else {
                        <a href="@valueAsString">@link(home.label(valueAsString)).get</a>
                    }
                </td>
            </tr>
        }
    }
}
